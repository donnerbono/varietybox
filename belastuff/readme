This is main from O2Omain display code. The only bit you need for the variety box is lines 230 to 284 which allow stuff to be placed on the screen in specific places etc.
